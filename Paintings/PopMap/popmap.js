let poplayer=null,co2layer=null,aqlayer=null,popmap=null;const AQICN_API_KEY="373e5a508f92508086306dcbe5da75cb7e878df7";async function loadGeoTIFF(e){const a=await fetch(e),o=await a.arrayBuffer();return parseGeoraster(o)}function createMap(){const e=L.map("popmap",{zoomControl:!1,minZoom:3,maxZoom:10}).setView([51.505,-.09],3);return L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:19}).addTo(e),e}async function addGeoRasterLayer(e,a,o,t,n){const r=await loadGeoTIFF(a);return new GeoRasterLayer({attribution:n,georaster:r,opacity:.75,resolution:64,pixelValuesToColorFn:e=>{const a=e[0];if(!(-200===a||a<t))return o(a).hex()}}).addTo(e)}function addAirQualityLayer(e){return L.tileLayer(`https://tiles.waqi.info/tiles/usepa-aqi/{z}/{x}/{y}.png?token=${AQICN_API_KEY}`,{attribution:'Air Quality Tiles &copy; <a href="http://waqi.info">waqi.info</a>'}).addTo(e)}async function initMap(){document.getElementById("loading-screen").style.display="flex",popmap=createMap();const e=chroma.scale(["white","yellow","orange","red"]).domain([0,50,500,1e4]),a=chroma.scale(["white","lightblue","blue","darkblue"]).domain([0,50,500,1e4]);let o=0;function t(){o++,3===o&&(document.getElementById("loading-screen").style.display="none")}poplayer=await addGeoRasterLayer(popmap,"/assets/maps/pop2.tif",e,20,"European Commission"),poplayer.on("load",t),co2layer=await addGeoRasterLayer(popmap,"/assets/maps/co2_small.tif",a,10,"European Commission"),co2layer.on("load",t),aqlayer=addAirQualityLayer(popmap),aqlayer.on("load",t)}document.addEventListener("DOMContentLoaded",initMap),document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("togglePopulation").addEventListener("change",(e=>{e.target.checked?poplayer.addTo(popmap):popmap.removeLayer(poplayer)})),document.getElementById("toggleCO2").addEventListener("change",(e=>{e.target.checked?co2layer.addTo(popmap):popmap.removeLayer(co2layer)})),document.getElementById("toggleAQ").addEventListener("change",(e=>{e.target.checked?aqlayer.addTo(popmap):popmap.removeLayer(aqlayer)}))}));